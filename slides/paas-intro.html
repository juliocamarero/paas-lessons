<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=1024, user-scalable=no">

	<title>PaaS fundalmentals for developers</title>
	
	<!-- Required stylesheet -->
	<link rel="stylesheet" href="core/deck.core.css">
	
	 <!-- fonts -->
    <link rel='stylesheet' href='http://fonts.googleapis.com/css?family=PT+Sans:400,700,400italic,700italic|PT+Sans+Narrow:400,700|Ubuntu+Mono:400,700' type='text/css'>

	<link rel="stylesheet" href="extensions/goto/deck.goto.css">
	<link rel="stylesheet" href="extensions/menu/deck.menu.css">
	<link rel="stylesheet" href="extensions/navigation/deck.navigation.css">
	<link rel="stylesheet" href="extensions/status/deck.status.css">
	<link rel="stylesheet" href="extensions/hash/deck.hash.css">
	<link rel="stylesheet" href="extensions/scale/deck.scale.css">

	<!-- Style theme. More available in /themes/style/ or create your own. -->
	<link rel="stylesheet" href="themes/style/web-2.0.css">
	
	<link rel="stylesheet" id="transition-theme-link" href="themes/transition/fade.css">   
    <link rel="stylesheet" id="style-theme-link" href="liferay.css">
	
	<script src="jquery-1.7.2.min.js"></script>
    <script src="modernizr.custom.js"></script>
    <script src="core/deck.core.js"></script>
    <script src="extensions/hash/deck.hash.js"></script>
    <script src="extensions/menu/deck.menu.js"></script>
    <script src="extensions/goto/deck.goto.js"></script>
    <script src="extensions/status/deck.status.js"></script>

    <link rel="stylesheet" href="solarized_light.css">
    <script src="highlight.pack.js"></script>

   <script>
    $(document).ready(function() {
            $.deck('.slide');
            $('pre').each(function(i, e) {
                    hljs.highlightBlock(e, '  ');
            });
            $('code').each(function(i, e) {
                    hljs.highlightBlock(e);
            });
    });
    </script>
</head>

<body class="deck-container">

<p class="deck-status">slide <span class="deck-status-current"></span> / <span class="deck-status-total"></span></p>

<section class="slide" style="font-size: 100%">
   <h1>
    <div>PaaS fundamentals for developers</div>
    <div style="font-size: 38%">Developing applications in the world of Cloud Computing</div>
    <br/>
    <div style="font-size: 50%">Miguel Pastor</div>
    <div style="font-size: 50%">miguelinlas3@gmail.com</div>
    <div style="font-size: 50%">Twitter handler: <a href="http://twitter.com/miguelinlas3">miguelinlas3</a></div>
    <div style="font-size: 50%"><br/></div>
   </h1>
</section>

<section class="slide" style="margin-left:11%">
	<h2>A little bit about me</h2>
	<ul>
		<div class="slide">
			<li>Cloud computing and distributed systems</li>
		</div>		
		<div class="slide">
			<li>Interests in concurrent and distributed programming. Functional programming advocate!
		</div>
		<div class="slide">
			<li>Scala, OSGI and AspectJ enthusiast</li>
		</div>
		<div class="slide">
			<li>Erlang aficionado</li>
		</div>
		<div class="slide">
			<li>PHD student</li>
		</div>		
		<div class="slide">
			<li>Twitter handler: <a href="http://twitter.com/miguelinlas3">miguelinlas3</a></li>
		</div>
	</ul>
</section>

<section class="slide">
	<h1>What will we talking about?</h1>
</section>

<section class="slide" style="margin-left:11%">
	<h2>Agenda</h2>
	<ul>
		<div class="slide">
			<li>Introduction to Cloud Computing</li>
		</div>
		<div class="slide">
			<li>PaaS fundamentals</li>
			<div class="slide">	
				<ul>			
					<div class="slide">	
						<li>What it is a PaaS?</li>
					</div>
					<div class="slide">	
						<li>How it works?</li>
					</div>
					<div class="slide">	
						<li>Alternatives</li>
					</div>
				<ul>
			</div>
		</div>
		<div class="slide">
			<ul>
				<li>A real example</li>
					<ul>
						<div class="slide">	
							<li>Developing a small application</li>
						</div>
						<div class="slide">	
							<li>Testing it in our local environment</li>
						</div>
						<div class="slide">	
							<li>Deployment in a production environment</li>
						</div>			
						<div class="slide">	
							<li>Tooling</li>
						</div>
					</ul>
				</li>
			</ul>
		</div>
		<div class="slide">
			<li>Moving our app to a different provider</li>
		</div>
		<div class="slide">
			<li>Questions and answers</li>
		</div>
	</ul>
</section>

<section class="slide">
	<h1>
		Cloud!??
		<div style="font-size: 50%">What is this about</div>
	</h1>
</section>

<section class="slide" >
	<div class="slide" style="margin-left:11%">
		<h2>Cloud Computing definition</h2>
			<blockquote cite="http://en.wikipedia.org/wiki/Cloud_computing">
				Cloud computing is the use of computing resources (hardware and software) that are delivered as a service over a network (typically the Internet).   		
	  			<p><cite><a href="">Wikipedia</a></cite></p>
			</blockquote>
	</div>
	<div class="slide" style="margin-left:11%">
		<h2>Cloud foundations</h2>
		<div class="slide">
			<h3>Computational resources</h3>
			<ul>
				<div class="slide">
					<li><p>Resource pool</p></li>
				</div>
				<div class="slide">
					<li><p>Subscription</p></li>
				</div>
				<div class="slide">
					<li><p>Deployment alternatives: managed, external and Cloud</p></li>
				</div>
			</ul>				
		</div>	
	</div>	
</section>

<section class="slide" >
	<div class="slide" style="margin-left:11%">
		<h2>Cloud foundations</h2>				
			<div class="slide">
				<h3>Virtualization</h3>
				<ul>
					<div class="slide">
						<li><p>Nothing new: 5-10 years</p></li>
					</div>
					<div class="slide">
						<li><p>Mainstay: Millions of servers</p></li>
					</div>
					<div class="slide">
						<li><p><italic>Commodity hardware</italic> usage</p></li>
					</div>
				</ul>	
			</div>
			<div class="slide">
				<h3>Elasticity</h3>
				<ul>
					<div class="slide">
						<li><p>Dynamic scaling</p></li>
					</div>
					<div class="slide">
						<li><p>Resources usage is regulated</p></li>
					</div>
					<div class="slide">
						<li><p>Traditionally over-provisioning is done. Slow and costly</p></li>
					</div>
				</ul>	
			</div>
			<div class="slide">
				<h3>Automatic provisioning</h3>								
				<ul>
					<div class="slide">
						<li><p>All operations are done via API</p></li>
					</div>
					<div class="slide">
						<li><p>Dymically: based on the requirements</p></li>
					</div>
					<div class="slide">
						<li><p>Handling unexpected conditions</p></li>
					</div>
					<div class="slide">
						<li><p>Pay for use!</p></li>
					</div>
				</ul>			
			</div>
			<div class="slide">
				<h3>Measurement and paying</h3>
				<ul>
					<div class="slide">
						<li><p>Pay for use!</p></li>
					</div>
					<div class="slide">
						<li><p>Balanced competition!</p></li>
					</div>

				</ul>	
			</div>		
	</div>
</section>

<section class="slide">
	<h1>Do I really need the Cloud??</h1>
</section>

<section class="slide" style="margin-left:11%">
	<h2>Myth or reallity?</h2>
	<div class="slide"><h3>Trending topic</h3></div>
	<div class="slide"><h3>Our CIO says we need to be there</h3></div>
	<div class="slide"><h3>Faster time to market</h3></div>
	<div class="slide"><h3>Access to pooled resources</h3></div>
	<div class="slide"><h3>Hybrid IT</h3></div>
</section>

<section class="slide">
	<h1>Cloud models</h1>
</section>

<section class="slide">
	<h1>Infrastructure as a Service</h1>
</section>

<section class="slide" style="margin-left:11%">
	<h2>Infrastructure as a Service</h2>
	<div class="slide"><h3>Lowest level of abstraction</h3></div>
	<div class="slide">
		<h3>Everything is exposed as a service</h3>
		<ul>
			<div class="slide">
				<li><p>Virtual machines</p></li>
			</div>
			<div class="slide">
				<li><p>Load Balancers</p></li>
			</div>
			<div class="slide">
				<li><p>Firewalls</p></li>
			</div>
			<div class="slide">
				<li><p>Storage systems (databases, . . .)</p></li>
			</div>
		</ul>	
	</div>
	<div class="slide">
		<h2>Platform as a Service</h2>
	</div>

	<div class="slide"><h3>Higher level of abstraction</h3></div>
	<div class="slide">
		<h3>Applications and services. Forget everything about</h3>
		<ul>
			<div class="slide">
				<li><p>Virtual machines, CPUs, ...</p></li>
			</div>
			<div class="slide">
				<li><p>Storage</p></li>
			</div>
			<div class="slide">
				<li><p>IP Management</p></li>
			</div>
		</ul>	
	</div>
	<div class="slide"><h3>Common problem: Vendor Lock-in</h3></div>

	<div class="slide">
		<h2>Software as a Service</h2>
	</div>

	<div class="slide"><h3>Applications and services</h3></div>
	<div class="slide"><h3>Demand usage</h3></div>
	<div class="slide"><h3>Examples: GMail, Salesforce, ...</h3></div>

</section>

<section class="slide">
	<h1>Going deeper in PaaS</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>PaaS definition</h2>	
		<blockquote cite="">  		
			Platform as a service (PaaS) is a category of cloud computing services that provide a computing platform and a solution stack as a service
			<p><cite><a href="http://en.wikipedia.org/wiki/Platform_as_a_service">Wikipedia</a></cite></p>
		</blockquote>
		<div class="slide"><h2>Open PaaS</h2></div>
		<div class="slide"><h3>Support for different languages and frameworks</h3></div>		
		<div class="slide"><h3>Great choice of many application services: databases, messaging queues, cache solutions ...</h3></div>
		<div class="slide"><h3>Portability</h3></div>	
		<div class="slide"><h3>Extensible</h3></div>	
		<div class="slide"><h3>Agile development</h3></div>	
		<div class="slide"><h3>Automated application infrastructure</h3></div>
		<div class="slide"><h3>Self service app deployment</h3></div>
		<div class="slide"><h3>Cloud provider deployment freedom</h3></div>		
	</div>
</section>

<section class="slide">
	<h1>Building our application</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Tools</h2>	
		<div class="slide"><h3><a href="http://cloudfoundry.org">Cloud Foundry</a></h3></div>
		<div class="slide"><h3><a href="http://playframework.com">Play Framework</a></h3></div>		
		<div class="slide"><h3><a href="http://docs.cloudfoundry.com/tools/vmc/installing-vmc.html">CLI for Cloud Foundry</a></h3></div>
		<div class="slide"><h3><a href="http://www.springsource.org/sts">Eclipse STS</a></h3></div>
	</div>
	<div class="slide" style="margin-left:11%">
		<h2>What are we going to do?</h2>		
		<div class="slide"><h3>CloudFoundry overview</h3></div>
		<div class="slide"><h3>Install our Micro CloudFoundry environment</h3></div>		
		<div class="slide"><h3>Develop our application</h3></div>
		<div class="slide"><h3>Testing our development in a local environment</h3></div>
		<div class="slide"><h3>Deploying our application to a production environment</h3></div>
	</div>	
</section>

<section class="slide">	
	<h1>Cloud Foundry overview</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Open architecture</h2>
		<div class="slide"><p>Choice of clouds for deployment</p></div>
		<div class="slide"><p>Choice of industry-standard frameworks and application infrastructure services</p></div>
		<div class="slide"><p>Extensible architecture to “digest” future cloud innovation</p></div>
		<div class="slide"><p>Available as open source</p></div>
	</div>
	<div class="slide" style="margin-left:11%">
		<h2>Self-service application execution engine</h2>
		<div class="slide"><p>Build applications with latest high productivity frameworks</p></div>
	</div>
	<div class="slide" style="margin-left:11%">
		<h2>Automation engine for deployment and lifecycle management</h2>
		<div class="slide"><p>Deploy and cloud-scale applications in seconds</p></div>
	</div>
</section>
<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Alternatives</h2>
		<div class="slide"><p><img src="images/CloudFoundry.png" /></p></div>		
	</div>
</section>

<section class="slide">
	<h1>Installing the Micro Cloud Foundry environment</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Micro Cloud Foundry</h2>
		<div class="slide"><p>Intance of Cloud Foundry prepared to run in a developer machine</p></div>
		<div class="slide"><p>Distributed as a Virtual Machine image</p></div>
		<div class="slide"><p>Full instance</p></div>
		<div class="slide"><p>Develop and test in your local environment, deploy to any cloud</p></div>
	</div>
	<div class="slide" style="margin-left:11%">
		<h2>Prerequisites</h2>
		<div class="slide"><p>A <a href="https://cloudfoundry.com/micro">Cloud Foundry account</a></p></div>
		<div class="slide"><p>A <a href="http://www.vmware.com/products/workstation/overview.html">VMWare workstation</a>, <a href="http://www.vmware.com/products/fusion/overview.html">VMWare fusion</a> or <a href="http://www.vmware.com/products/player/overview.html">VMWare player</a></p></div>
	</div>
	<div class="slide" style="margin-left:11%">
		<h2>Installing the Command Line Tool (VMC)</h2>
		<div class="slide">
			<p>If Ruby is already installed in your machine just open a console and type:</p>
			<pre class="shell">
sudo gem install vmc
			</pre>
		</div>		
	</div>
</section>
<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Download and configure the micro instance</h2>
		<div class="slide">
			<p>Configure our <a href="https://cloudfoundry.com/micro">Micro Cloud Foundry account</a></p>
			<ul>
				<div class="slide"><li>Enter an unique domain name</li></div>
				<div class="slide"><li>Configuration token is created</li></div>
				<div class="slide"><li>Download the VM file</li></div>
			</ul>
		</div>
	</div>
	<div class="slide" style="margin-left:11%">
		<h2>Start and configure the Virtual Machine</h2>
		<div class="slide"><img src="images/MicroInstanceConfiguration.png" /></div>		
	</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Create a user to manage the deployments</h2>
		<div class="slide">
			<p>Target our micro cloud</p>
			<pre class="shell">
vmc target api.miguelinlas3.cloudfoundry.me
			</pre>
		</div>
		<div class="slide">
			<p>Create a new account. Enter your email address and the password (twice)</p>
			<pre class="shell">
vmc register
			</pre>
		</div>
		<div class="slide">
			<p>We can log into the vm using the root (or vcap) users. Use the password setted at the beginning of the process</p>
			<pre class="shell">
ssh root@miguelinlas3.cloudfoundry.me
			</pre>
		</div>
		<div class="slide">
			<br/>
			<h3>We are ready!! Let´s start our small application!</h3>
		</div>	
	</div>
</section>

<section class="slide">
	<h1>Developing our small application</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Development tools we are using</h2>
		<div class="slide">
			<h3>Play framework</h3>
		</div>
		<ul>
			<div class="slide"><li><p>Scala powered. Leverage as much as possible to the compiler type checker</p></li></div>
			<div class="slide"><li><p>Reactive model: based evented IO</p></li></div>
			<div class="slide"><li><p>Stateless, easy to scale</p></li></div>
			<div class="slide"><li><p>Scala and Java APIs</p></li></div>
		</ul>
		<div class="slide">
			<h3>PostgreSQL database</h3>
		</div>
		<ul>
			<div class="slide"><li><p>One of the most popular Open Source RDMBS</p></li></div>
		</ul>
		<div class="slide">
			<h3>MongoDB</h3>
		</div>
		<ul>
			<div class="slide"><li><p>NoSQL storage</p></li></div>
		</ul>
		<div class="slide">
			<h3>RabbitMQ</h3>
		</div>
		<ul>
			<div class="slide"><li><p>Message queue system</p></li></div>
			<div class="slide"><li><p>AMQP</p></li></div>
		</ul>
	</div>
</section>

<section class="slide">
	<h1>Getting started</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>First step: Creating our first application</h2>
		<div class="slide">
			<h3>Create a simple play application</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
play new getting-started
			</pre>
		</div>
		<div class="slide">
			<h3>Start the app</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
play run
			</pre>
		</div>
		<div class="slide">
			<h3>Create a small change in the Application.scala file</h3>
		</div>
		<div class="slide">			
			<pre class="scala">
package controllers

import play.api._
import play.api.mvc._

object Application extends Controller {
  
  def index = Action {
    Ok("This is our first Play application. And it is written in Scala")
  }
  
}
			</pre>
		</div>
	</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Second step: Deploying our first application</h2>
		<div class="slide">
			<h3>Target our micro instance</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
vmc target http://api.miguelinlas3.cloudfoundry.me
			</pre>
		</div>
		<div class="slide">
			<h3>Login</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
vmc login
			</pre>
		</div>
		<div class="slide">
			<h3>Create the artifact of our application</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
play clean dist
			</pre>
		</div>
		<div class="slide">
			<h3>Deploy the previous artifact into our micro instance</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
vmc push --path=dist/getting-started-1.0-SNAPSHOT.zip
			</pre>
		</div>

	</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Exercice. Play with the command line tool</h2>
		<div class="slide">
			<h3>List all the applications</h3>
			<h3>Show the info of an application</h3>
			<h3>Stop an application</h3>
			<h3>Restart an application</h3>
			<h3>Deploy a new version of an application</h3>
		</div>
	</div>
</section>

<section class="slide">
	<h1>
		The TODO application
		<div style="font-size: 70%">Connecting to a database</div>
	</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>A simple TODO application</h2>
		<div class="slide">
			<h3>What can we do?</h3>
		</div>
		<div class="slide"><p>Create TODO task</p></div>
		<div class="slide"><p>List all TODO tasks</p></div>
	</div>

	<div class="slide" style="margin-left:11%">
		<h2>Components of the application</h2>
		<div class="slide">
			<h3>Model</h3>
		</div>
		<div class="slide">			
			<pre class="java">
package models;

import play.db.ebean.Model;
import java.util.List;
import javax.persistence.Entity;
import javax.persistence.Id;

@Entity
public class Task extends Model {
 	public static Finder<Long,Task> find = new Finder(
    	Long.class, Task.class
  	);
	public static List<Task> all() {
    	return find.all();
  	}
	public static void delete(Long id) {
	    find.ref(id).delete();
	}
    @Id
    public String id;
    public String contents;
}
			</pre>
		</div>
	</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Components of the application</h2>
		<div class="slide">
			<h3>Routes</h3>
		</div>
		<div class="slide">			
			<pre class="scala">
# Home page
GET     /                           controllers.Application.index()

# Map static resources from the /public folder to the /assets URL path
GET     /assets/*file               controllers.Assets.at(path="/public", file)


POST    /task                       controllers.Application.addTask()
GET     /tasks                      controllers.Application.allTasks()
			</pre>
		</div>	
	</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Components of the application</h2>
		<div class="slide">
			<h3>Controllers</h3>
		</div>
		<div class="slide">			
			<pre class="scala">
package controllers;

import models.Task;
import play.data.Form;

import play.*;
import play.mvc.*;

import play.db.ebean.Model;

import java.util.List;

import static play.libs.Json.toJson;

import views.html.*;

public class Application extends Controller {
  
  public static Result addTask() {
		Form<Task> form = form(Task.class).bindFromRequest();

		Task task = form.get();
		task.save();

		return redirect(routes.Application.index());
  }

  public static Result index() {
    return ok(index.render("TODO Application", form(Task.class)));
  }

	public static Result allTasks() {
	    return ok(toJson(Task.all()));
	}
  
}
			</pre>
		</div>		
	</div>
</section>


<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Deploying our TODO application</h2>
		<div class="slide">
			<h3>Create the artifact of our application</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
play clean dist
			</pre>
		</div>
		<div class="slide">
			<h3>Deploy the previous artifact into our micro instance</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
vmc push --path=dist/todo-1.0-SNAPSHOT.zip
			</pre>
		</div>
		<div class="slide">
			<h3>Configure the deployment. Remember to bind the service!</h3>
		</div>
		<div class="slide">
			<p><img src="images/CloudFoundryDatabaseConf.png" /></p>
		</div>
	</div>
</section>


<section class="slide">
	<h1>
		The TODO application
		<div style="font-size: 70%">Using a NoSQL storage</div>
	</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Let´s build the same TODO application using MongoDB</h2>		
	</div>

	<div class="slide" style="margin-left:11%">
		<h2>Creating a new application</h2>
		<div class="slide">			
			<pre class="shell">
play new todo-nosql
			</pre>
		</div>
	</div>
	<div class="slide" style="margin-left:11%">
		<h2>Add the required Mongo dependencies</h2>
		<div class="slide">			
			<p>Add the required libraries to the <strong>/lib</strong> folder of our project.</p>
			<pre class="shell">
<a href="http://www.mongodb.org/downloads">mongo-2.0.8.jar</a>
<a href="http://code.google.com/p/google-gson/downloads/list">gson-2.2.2.jar</a>
			</pre>
		</div>
	</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Components of the application</h2>
		<div class="slide">
			<h3>Routes</h3>
		</div>
		<div class="slide">			
			<pre class="scala">
# Routes
# This file defines all application routes (Higher priority routes first)
# ~~~~

# Home page
GET     /                           controllers.Application.index()

# Map static resources from the /public folder to the /assets URL path
GET     /assets/*file               controllers.Assets.at(path="/public", file)

# Tasks          
GET     /tasks                  controllers.Application.tasks()
POST    /tasks                  controllers.Application.newTask()
POST    /tasks/:id/delete       controllers.Application.deleteTask(id: Long)

			</pre>
		</div>

	</div>
	<div class="slide" style="margin-left:11%">
		<h2>Components of the application</h2>
		<div class="slide">
			<h3>Models</h3>
		</div>
		<div class="slide">			
			<pre class="java">
package models;

public class Task {
  public Long id;
  public String label;
}
			</pre>
		</div>	
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Developing mode</h2>
		<div class="slide">
			<h3>Start a MongoDB instance</h3>
		</div>
		<div class="slide">			
			<pre class="bash">
mkdir /tmp/mongdb
./mongod -dbpath=/tmp/mongdob
			</pre>
		</div>
		<div class="slide">
			<h3>Start our application</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
play clean run
			</pre>			
		</div>
		<div class="slide">
			<h3>Create some data in our application</h3>
		</div>
		<div class="slide">
			<h3>Connect to MongoDB from the command line and query some date</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
./mongo
MongoDB shell version: 2.2.2
connecting to: test
Welcome to the MongoDB shell.
For interactive help, type "help".
For more comprehensive documentation, see
	http://docs.mongodb.org/
Questions? Try the support group
	http://groups.google.com/group/mongodb-user
> use mongodb;
switched to db mongodb
> use db;
switched to db db
> db.tasklist.find();
{ "_id" : ObjectId("50f8537003646522c0cd32f8"), "id" : NumberLong(0), "label" : "My first task" }
> 
			</pre>			
		</div>
	</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Deploying our TODO application</h2>
		<div class="slide">
			<h3>Configure to use a remote MongoDB instance</h3>
		</div>
		<div class="slide">			
			<pre class="java">
boolean local  = false; // do it with a conf property
			</pre>
		</div>
		<div class="slide">
			<h3>Create the artifact of our application</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
play clean dist
			</pre>
		</div>
		<div class="slide">
			<h3>Deploy the previous artifact into our micro instance</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
vmc push --path=dist/todo-nosql-1.0-SNAPSHOT.zip
			</pre>
		</div>
		<div class="slide">
			<h3>Configure the deployment. Remember to bind the MongoDB service!</h3>
		</div>
		<div class="slide">
			<blockquote cite="https://cloudfoundry.atlassian.net/browse/CF-141">
				https://cloudfoundry.atlassian.net/browse/CF-141
	  			<p><cite><a href="https://cloudfoundry.atlassian.net/browse/CF-141">Cloud Foundry issues tracker</a></cite></p>
			</blockquote>			
		</div>
	</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h1>Targeting a production environment</h1>
	</div>
</section>
<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Deploy an application to CloudFoundy.com</h2>
		<div class="slide">
			<h3>Target our CloudFoundry.com account</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
vmc target api.miguelinlas3.cloudfoundry.com
			</pre>
		</div>
		<div class="slide">
			<h3>Do the login</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
vmc login (use your CloudFoundry credentials)
			</pre>
		</div>
		<div class="slide">
			<h3>Generate the artifact (our play application!)</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
play clean dist
			</pre>
		</div>
		<div class="slide">
			<h3>Create and bind the required services</h3>
		</div>
		<div class="slide">
			<h3>There is no difference with our micro cloud!!</h3>
		</div>		
	</div>
</section>

<section class="slide">
	<h1>And the next week . . .</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>More contents</h2>
		<div class="slide"><p>Go deeper into other parts of the stack: other languages, frameworks, ...</p></div>
		<div class="slide"><p>Moving our application to a different PaaS provider</p></div>
		<div class="slide"><p>Going to a low level approach: an IaaS Cloud provider example</p></div>		
	</div>
	<div class="slide" style="margin-left:11%">
		<h2>Optional</h2>
		<div class="slide"><p>Quick overview over the main PaaS Cloud providers. Deploy our app into some of them</p></div>
		<div class="slide"><p>Architecture and internals of CloudFoundry</p></div>
		<div class="slide"><p>Resume of the techs and foundations of the Cloud world</p></div>
	</div>
</section>

<section class="slide">
	<h1>Exercice one</h1>
</section>

<section class="slide">
	<h1>
		Exercice
		<div style="font-size: 70%">Writing a small computer inventory</div>
	</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Computer inventory</h2>
		<div class="slide"><p>Accesing the database</p></div>
		<div class="slide"><p>Database and evolutions</p></div>
		<div class="slide"><p>Writing the controller logic</p></div>
		<div class="slide"><p>Configuring the routes of our application</p></div>
		<div class="slide"><p>Writing the views (beautifying with Twitter bootstrap)</p></div>
	</div>
	<div class="slide" style="margin-left:11%">
		<h2>Deployment</h2>
		<div class="slide"><p>Test in our development environment</p></div>
		<div class="slide"><p>Deploy to our Micro instance</p></div>
		<div class="slide"><p>Deploy to our production cloud provider CloudFoundry.com</p></div>
	</div>
	<div class="slide" style="margin-left:11%">
		<h2>Exercices</h2>
		<div class="slide"><p>Convert our application into a REST backend</p></div>
		<div class="slide"><p>Include the ability to attach a document with every machine</p></div>
		<div class="slide"><p>Test it!!</p></div>		
		<div class="slide"><p>Deploy to our production cloud provider CloudFoundry.com</p></div>
	</div>
</section>

<section class="slide">
	<h1>
		Testing our REST backend
	</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Testing our REST backend using curl</h2>
		<div class="slide">
			<h3>Installing curl</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
<a href="http://curl.haxx.se/docs/install.html">How to install Curl</a>
			</pre>
		</div>
		<div class="slide">
			<h3>Get a company by id</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
curl -i http://localhost:9000/company/11
			</pre>
		</div>			
		<div class="slide">
			<h3>List all the companies in a page</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
curl -i http://localhost:9000/companies?page=1
			</pre>
		</div>				
		<div class="slide">
			<h3>List all the computers in a page</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
curl -i http://localhost:9000/rcomputers?page=1
			</pre>
		</div>
		<div class="slide">
			<h3>Create a new computer</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
curl -i --data "" http://localhost:9000/rcomputers/MyNewMackBookPro/2013-01-25/2023-01-25/1
			</pre>
		</div>
	</div>
</section>

<section class="slide">
	<h1>
		Storing documents in Amazon S3		
	</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>AWS S3 as documents storage</h2>

		<div class="slide">
			<h3>SDK dependency</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
val appDependencies = Seq(
  "com.amazonaws" % "aws-java-sdk" % "1.3.29"   
)
			</pre>
		</div>

	</div>
	<div class="slide" style="margin-left:11%">
		<h2>Creating a new Play2 plugin</h2>
		<div class="slide">
			<h3>Write the plugin</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
@Override
public void onStart() {
    String accessKey = application.configuration().getString(AWS_ACCESS_KEY);
    String secretKey = application.configuration().getString(AWS_SECRET_KEY);
    s3Bucket = application.configuration().getString(AWS_S3_BUCKET);
    
    if ((accessKey != null) && (secretKey != null)) {
        AWSCredentials awsCredentials = new BasicAWSCredentials(accessKey, secretKey);
        amazonS3 = new AmazonS3Client(awsCredentials);
        amazonS3.createBucket(s3Bucket);
        Logger.info("Using S3 Bucket: " + s3Bucket);
    }
}

@Override
public boolean enabled() {
    return (application.configuration().keys().contains(AWS_ACCESS_KEY) &&
            application.configuration().keys().contains(AWS_SECRET_KEY) &&
            application.configuration().keys().contains(AWS_S3_BUCKET));
}
			</pre>
		</div>		
	</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>AWS S3 as documents storage</h2>

		<div class="slide">
			<h3>Configure the plugin</h3>
		</div>
		<div class="slide">			
			<pre class="java">
Create a file play.plugins in the conf folder
Write 1500:plugins.S3Plugin
			</pre>
		</div>
		<div class="slide">
			<h3>S3 configuration</h3>
		</div>
		<div class="slide">			
			<pre class="java">
// use ENV vars instead of writing it here
aws.access.key=${?AWS_ACCESS_KEY}
aws.secret.key=${?AWS_SECRET_KEY}
aws.s3.bucket=the-name-of-your-bucket
			</pre>
		</div>
		<div class="slide">
			<h3>Create an entity and a controller</h3>
		</div>
		<div class="slide">			
			<pre class="java">
@Override
public void save() {
    if (S3Plugin.amazonS3 == null) {
        Logger.error("Could not save because amazonS3 was null");
        throw new RuntimeException("Could not save");
    }
    else {
        this.bucket = S3Plugin.s3Bucket;        
        super.save(); // assigns an id
        PutObjectRequest putObjectRequest = new PutObjectRequest(bucket, getActualFileName(), file);
        putObjectRequest.withCannedAcl(CannedAccessControlList.PublicRead);
        S3Plugin.amazonS3.putObject(putObjectRequest);
    }
}
@Override
public void delete() {
    if (S3Plugin.amazonS3 == null) {
        Logger.error("Could not delete because amazonS3 was null");
        throw new RuntimeException("Could not delete");
    }
    else {
        S3Plugin.amazonS3.deleteObject(bucket, getActualFileName());
        super.delete();
    }
}				
			</pre>
		</div>		
	</div>
</section>

<section class="slide">
	<h1>
		Changing the provider
		<div style="font-size: 70%">Deploying our app to the Heroku PaaS</div>		
	</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Setting up the environment</h2>
		<div class="slide">
			<h3>Create an account in <a href="http://heroku.com">Heroku</a></h3>
		</div>
		<div class="slide">
			<h3>Create an account in <a href="http://github.com">Github</a></h3>
		</div>			
		<div class="slide">
			<h3>Download the <a href="https://toolbelt.heroku.com/">Heroku Toolbelt</a></h3>
		</div>			
	</div>
	<div class="slide" style="margin-left:11%">
		<h2>Deploying our application</h2>
		<div class="slide">
			<h3>Create a new Github repo</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
<a href="https://help.github.com/articles/creating-a-new-repository">Create a new repository in Github</a>
			</pre>
		</div>
		<div class="slide">
			<h3>Clone the repo in our local machine and set the initial description</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
git clone git@github.com:migue/computer-database.git
cd computer-database
touch README.md
vi README.md
git add README.md
git commit --message="Description with the contents of the repo and the purpose of it"
git push origin master
			</pre>
		</div>			
		<div class="slide">
			<h3>Copy the contents of the application to this repo</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
cp -R /Users/migue/courses/paas-lessons/applications/computer-database/* /tmp/computer-database/
			</pre>
		</div>				
	</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Setting up the environment</h2>
		<div class="slide">
			<h3>Typical gitignore</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
touch .gitignore
vi .gitignore
# Paste this content
logs
project/project
project/target
target
tmp
			</pre>
		</div>
		<div class="slide">
			<h3>Configure the Heroku tooling</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
heroku login
			</pre>
		</div>
		<div class="slide">
			<h3>Create our Heroku application</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
heroku create
			</pre>
		</div>		
		<div class="slide">
			<h3>Deploy our application to Heroku</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
heroku keys:add ~/.ssh/id_rsa.pub
git push heroku master
			</pre>
		</div>	
		<div class="slide">
			<h3>Check our app is running</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
heroku ps
			</pre>
		</div>				
	</div>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Setting up the environment</h2>
		<div class="slide">
			<h3>Configure a PostgreSQL database: add dependency in the Build.scala file</h3>
		</div>
		<div class="slide">			
			<pre class="scala">
    val appDependencies = Seq(
      // Add your project dependencies here,
      "postgresql" % "postgresql" % "9.1-901-1.jdbc4"
    )
			</pre>
		</div>
		<div class="slide">
			<h3>Create Heroku config file</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
touch Procfile

# Paste this content

web: target/start -Dhttp.port=${PORT} ${JAVA_OPTS} -DapplyEvolutions.default=true -Ddb.default.driver=org.postgresql.Driver -Ddb.default.url=${DATABASE_URL}
			</pre>
		</div>
		<div class="slide">
			<h3>Visit our application</h3>
		</div>
		<div class="slide">			
			<pre class="shell">
heroku open
			</pre>
		</div>	
		<div class="slide">
			<h3>Take a look to the available commands</h3>
		</div>		
		<div class="slide">			
			<pre class="shell">
heroku
			</pre>
		</div>				
	</div>
</section>

<section class="slide">
	<h1>
		One more provider
		<div style="font-size: 70%">Deploying our app to the OpenShift PaaS</div>		
	</h1>
</section>

<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Setting up the environment</h2>
		<div class="slide">
			<h3>Create an account in <a href="https://openshift.redhat.com">OpenShift</a></h3>
		</div>
		<div class="slide">
			<h3>Create an account in <a href="http://github.com">Github</a></h3>
		</div>			
		<div class="slide">
			<h3>Install the command line tools</a></h3>
		</div>
		<div class="slide">			
			<pre class="shell">
sudo gem install rhc
rhc setup (if this is the first time you install the tools)
			</pre>
		</div>
<div class="slide">
			<h3>Create a demo app</a></h3>
		</div>
		<div class="slide">			
			<pre class="shell">
play new play2demo
cd play2demo
git init
			</pre>
		</div>
		<div class="slide">
			<h3>Create a raw (do it yourself) application</a></h3>
		</div>
		<div class="slide">			
			<pre class="shell">
rhc app create play2demo -t diy-0.1 --no-git -l miguelinlas3@gmail.com
			</pre>
		</div>
		<div class="slide">
			<h3>Initial deploy</a></h3>
		</div>
		<div class="slide">			
			<pre class="shell">
git remote add origin ssh://68fd7e8a361d4ad783a20a6e913b2727@play2demo-miguelinlas3.rhcloud.com/~/git/play2demo.git/
git pull -s recursive -X theirs origin master
git add .
git commit -m "initial deploy"
git remote add quickstart -m master git://github.com/opensas/play2-openshift-quickstart.git
git pull -s recursive -X theirs quickstart master
			</pre>
		</div>	
	</div>
</section>
<section class="slide">
	<h1>
		Deploy the computer inventory application
	</h1>
</section>
<section class="slide">
	<div class="slide" style="margin-left:11%">
		<h2>Deploying recipe</h2>
		<div class="slide">			
			<pre class="shell">
rhc app create -a computerdb -t diy-0.1 --nogit
git remote add origin ssh://uuid@computerdb-yourdomain.rhcloud.com/~/git/computerdb.git/
git pull -s recursive -X theirs origin master
git add .
git commit -m "initial deploy"
git remote add quickstart -m master git://github.com/opensas/play2-openshift-quickstart.git
git pull -s recursive -X theirs quickstart master

play clean compile stage
git add .
git commit -m "deploying computerdb application"
git push origin

rhc app tail -a computerdb
# openshift action_hooks scripts configuration
# ~~~~~
openshift.play.params="-DapplyEvolutions.default=true"
Now deploy your app once again with './openshift_deploy -q'

rhc app cartridge add -a computerdb -c postgresql-8.4

# openshift mysql database
db.default.driver=com.mysql.jdbc.Driver
db.default.url="jdbc:mysql://"${OPENSHIFT_DB_HOST}":"${OPENSHIFT_DB_PORT}/${OPENSHIFT_APP_NAME}
db.default.user=${OPENSHIFT_DB_USERNAME}
db.default.password=${OPENSHIFT_DB_PASSWORD}
You'll also have to include the mysql driver as a dependency. Add this line to project/Build.scala file:

val appDependencies = Seq( 
    "postgresql" % "postgresql" % "8.4-901-1.jdbc4",
) 

# play framework command configuration
# ~~~~~
#openshift.play.params="-Xmx512M"
			</pre>
		</div>		
	</div>
</section>

<section class="slide">
	<h1>
		That´s all!!
	</h1>
</section>

<section class="slide" style="margin-left:11%">
	<h2>References</h2>
	<div class="slide"><p><a href="https://cloudfoundry.org">CloudFoundry.org</a></p></div>
	<div class="slide"><p><a href="https://cloudfoundry.com">CloudFoundry.com</a></p></div>
	<div class="slide"><p><a href="https://openshift.redhat.com">OpenShift</a></p></div>
	<div class="slide"><p><a href="https://heroku.com">Heroku</a></p></div>
	<div class="slide"><p><a href="https://aws.amazon.com">Amazon AWS</a></p></div>
	<div class="slide"><p><a href="https://playframework.org">Play Framework</a></p></div>
	
</section>


<!-- End slides. -->


<!-- Begin extension snippets. Add or remove as needed. -->

<!-- deck.navigation snippet -->
<a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
<a href="#" class="deck-next-link" title="Next">&#8594;</a>

<!-- deck.status snippet -->
<p class="deck-status">
	<span class="deck-status-current"></span>
	/
	<span class="deck-status-total"></span>
</p>

<!-- deck.goto snippet
<form action="." method="get" class="goto-form">
	<label for="goto-slide">Go to slide:</label>
	<input type="text" name="slidenum" id="goto-slide" list="goto-datalist">
	<datalist id="goto-datalist"></datalist>
	<input type="submit" value="Go">
</form>
 -->

<!-- deck.hash snippet -->
<a href="." title="Permalink to this slide" class="deck-permalink">#</a>
</body>
</html>
